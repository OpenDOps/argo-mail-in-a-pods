{
  "name": "mailer/cilium-gateway-mail-in-a-pods-gateway-test/listener",
  "active_state": {
    "version_info": "2088",
    "listener": {
      "@type": "type.googleapis.com/envoy.config.listener.v3.Listener",
      "name": "mailer/cilium-gateway-mail-in-a-pods-gateway-test/listener",
      "address": {
        "socket_address": {
          "address": "127.0.0.1",
          "port_value": 10285
        }
      },
      "filter_chains": [
        {
          "filter_chain_match": {
            "transport_protocol": "raw_buffer"
          },
          "filters": [
            {
              "name": "cilium.network",
              "typed_config": {
                "@type": "type.googleapis.com/cilium.NetworkFilter"
              }
            },
            {
              "name": "envoy.filters.network.http_connection_manager",
              "typed_config": {
                "@type": "type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager",
                "stat_prefix": "listener-insecure",
                "rds": {
                  "config_source": {
                    "api_config_source": {
                      "api_type": "GRPC",
                      "grpc_services": [
                        {
                          "envoy_grpc": {
                            "cluster_name": "xds-grpc-cilium"
                          }
                        }
                      ],
                      "set_node_on_first_message_only": true,
                      "transport_api_version": "V3"
                    },
                    "initial_fetch_timeout": "30s",
                    "resource_api_version": "V3"
                  },
                  "route_config_name": "mailer/cilium-gateway-mail-in-a-pods-gateway-test/listener-insecure"
                },
                "http_filters": [
                  {
                    "name": "envoy.filters.http.grpc_web",
                    "typed_config": {
                      "@type": "type.googleapis.com/envoy.extensions.filters.http.grpc_web.v3.GrpcWeb"
                    }
                  },
                  {
                    "name": "envoy.filters.http.grpc_stats",
                    "typed_config": {
                      "@type": "type.googleapis.com/envoy.extensions.filters.http.grpc_stats.v3.FilterConfig",
                      "emit_filter_state": true,
                      "enable_upstream_stats": true
                    }
                  },
                  {
                    "name": "cilium.l7policy",
                    "typed_config": {
                      "@type": "type.googleapis.com/cilium.L7Policy",
                      "access_log_path": "/var/run/cilium/envoy/sockets/access_log.sock"
                    }
                  },
                  {
                    "name": "envoy.filters.http.router",
                    "typed_config": {
                      "@type": "type.googleapis.com/envoy.extensions.filters.http.router.v3.Router"
                    }
                  }
                ],
                "use_remote_address": true,
                "upgrade_configs": [
                  {
                    "upgrade_type": "websocket"
                  }
                ],
                "stream_idle_timeout": "300s",
                "internal_address_config": {
                  "cidr_ranges": [
                    {
                      "address_prefix": "10.0.0.0",
                      "prefix_len": 8
                    },
                    {
                      "address_prefix": "172.16.0.0",
                      "prefix_len": 12
                    },
                    {
                      "address_prefix": "192.168.0.0",
                      "prefix_len": 16
                    },
                    {
                      "address_prefix": "127.0.0.1",
                      "prefix_len": 32
                    }
                  ]
                },
                "common_http_protocol_options": {
                  "max_stream_duration": "0s"
                }
              }
            }
          ]
        },
        {
          "filter_chain_match": {
            "transport_protocol": "tls",
            "server_names": [
              "mailer3.kuprin.su"
            ]
          },
          "filters": [
            {
              "name": "cilium.network",
              "typed_config": {
                "@type": "type.googleapis.com/cilium.NetworkFilter"
              }
            },
            {
              "name": "envoy.filters.network.http_connection_manager",
              "typed_config": {
                "@type": "type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager",
                "stat_prefix": "listener-secure",
                "rds": {
                  "config_source": {
                    "api_config_source": {
                      "api_type": "GRPC",
                      "grpc_services": [
                        {
                          "envoy_grpc": {
                            "cluster_name": "xds-grpc-cilium"
                          }
                        }
                      ],
                      "set_node_on_first_message_only": true,
                      "transport_api_version": "V3"
                    },
                    "initial_fetch_timeout": "30s",
                    "resource_api_version": "V3"
                  },
                  "route_config_name": "mailer/cilium-gateway-mail-in-a-pods-gateway-test/listener-secure"
                },
                "http_filters": [
                  {
                    "name": "envoy.filters.http.grpc_web",
                    "typed_config": {
                      "@type": "type.googleapis.com/envoy.extensions.filters.http.grpc_web.v3.GrpcWeb"
                    }
                  },
                  {
                    "name": "envoy.filters.http.grpc_stats",
                    "typed_config": {
                      "@type": "type.googleapis.com/envoy.extensions.filters.http.grpc_stats.v3.FilterConfig",
                      "emit_filter_state": true,
                      "enable_upstream_stats": true
                    }
                  },
                  {
                    "name": "cilium.l7policy",
                    "typed_config": {
                      "@type": "type.googleapis.com/cilium.L7Policy",
                      "access_log_path": "/var/run/cilium/envoy/sockets/access_log.sock"
                    }
                  },
                  {
                    "name": "envoy.filters.http.router",
                    "typed_config": {
                      "@type": "type.googleapis.com/envoy.extensions.filters.http.router.v3.Router"
                    }
                  }
                ],
                "use_remote_address": true,
                "upgrade_configs": [
                  {
                    "upgrade_type": "websocket"
                  }
                ],
                "stream_idle_timeout": "300s",
                "internal_address_config": {
                  "cidr_ranges": [
                    {
                      "address_prefix": "10.0.0.0",
                      "prefix_len": 8
                    },
                    {
                      "address_prefix": "172.16.0.0",
                      "prefix_len": 12
                    },
                    {
                      "address_prefix": "192.168.0.0",
                      "prefix_len": 16
                    },
                    {
                      "address_prefix": "127.0.0.1",
                      "prefix_len": 32
                    }
                  ]
                },
                "common_http_protocol_options": {
                  "max_stream_duration": "0s"
                }
              }
            }
          ],
          "transport_socket": {
            "name": "envoy.transport_sockets.tls",
            "typed_config": {
              "@type": "type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.DownstreamTlsContext",
              "common_tls_context": {
                "tls_certificate_sds_secret_configs": [
                  {
                    "name": "cilium-secrets/mailer-cafe-secret",
                    "sds_config": {
                      "api_config_source": {
                        "api_type": "GRPC",
                        "grpc_services": [
                          {
                            "envoy_grpc": {
                              "cluster_name": "xds-grpc-cilium"
                            }
                          }
                        ],
                        "set_node_on_first_message_only": true,
                        "transport_api_version": "V3"
                      },
                      "initial_fetch_timeout": "30s",
                      "resource_api_version": "V3"
                    }
                  }
                ]
              }
            }
          }
        }
      ],
      "listener_filters": [
        {
          "name": "envoy.filters.listener.tls_inspector",
          "typed_config": {
            "@type": "type.googleapis.com/envoy.extensions.filters.listener.tls_inspector.v3.TlsInspector"
          }
        },
        {
          "name": "cilium.bpf_metadata",
          "typed_config": {
            "@type": "type.googleapis.com/cilium.BpfMetadata",
            "bpf_root": "/sys/fs/bpf",
            "is_l7lb": true,
            "ipv4_source_address": "10.0.2.59",
            "enforce_policy_on_l7lb": true,
            "proxy_id": 10285,
            "ipcache_name": "cilium_ipcache_v2"
          }
        }
      ],
      "socket_options": [
        {
          "description": "Enable TCP keep-alive (default to enabled)",
          "level": "1",
          "name": "9",
          "int_value": "1"
        },
        {
          "description": "TCP keep-alive idle time (in seconds) (defaults to 10s)",
          "level": "6",
          "name": "4",
          "int_value": "10"
        },
        {
          "description": "TCP keep-alive probe intervals (in seconds) (defaults to 5s)",
          "level": "6",
          "name": "5",
          "int_value": "5"
        },
        {
          "description": "TCP keep-alive probe max failures.",
          "level": "6",
          "name": "6",
          "int_value": "10"
        }
      ]
    },
    "last_updated": "2025-11-19T21:00:11.758Z"
  }
}
